<%- include('components/html-head') %>
<body>
    <%- include('components/header') %>
    <%- include('components/search/search') %>
    
    <h3><%=track.title%></h3>
    <img src="../<%=track.image_url%>" alt=""> <br>

    <a href="../tracks/<%=track.id%>"><%=track.title%></a>

    <% for (artist of track.artists.split(/[,;]/)) {%>
        <a href="../search?q=<%=artist%>&f=ar,"><%=artist%></a>
    <%};%>

    <% for (genre of track.genres.split(/[,;]/)) {%>
        <a href="../search?q=<%=genre%>&f=gn,"><%=genre%></a>
    <%};%>

    <span><%=track.likes%></span>

    <audio controls preload="auto">
        <source src="<%=track.audio_url%>" type="audio/mpeg">
    </audio>

    <% if(playlistsContainingTrack){%>
        <label for="playlists_list"></label>
        <ul id="playlists_list">
            <%for(let playlist of playlistsContainingTrack){%>
                <li isSaved="<%=playlist.isSaved%>" isOwner="<%=playlist.isOwner%>" class="playlist interactable">
                    <a href="../playlists/<%=playlist.id%>">
                        <%=playlist.title%>
                    </a>
                </li>
            <%};%>
        </ul>
    <%};%>
    <br>
    
    <input id="is-liked" type="hidden" value="<%=isLiked%>">
    <button id="like-btn" onclick="like()">Like</button>

    <br>

    <button>Add to Playlist</button> 

    <% if(isOwner){ %>
        <br><button id="edit-btn" onclick="editTrack()">Edit</button><br>
        <button id="delete-btn" onclick="deleteTrack()">Delete</button><br>
    <%};%>

    <input id="loggin-flag" type="hidden" value="<%=loggedIn%>">
    <%- include('components/contextmenus/playlist') %>

    <br>
    <a href="/profiles/<%=track.owner_id%>">Profile</a>

    <form id="add_track_form" method="POST" action="/tracks/<%=track.id%>">
        <select multiple name="playlists" id="select_playlists" class="dropdown-menu">
            <%for(let playlist of cataloguePlaylists){%>
                <option value="<%=playlist.id%>"><%=playlist.title%></option>
            <%};%>    
        </select>

        <button type="submit">Add</button>
    </form>

    <div id="edit-track">
        <input type="text" name="title" id="title-inp" value="<%=track.title%>"> <br>
        <input type="text" name="artists" id="artists-inp" value="<%=track.artists%>"> <br>
        <input type="text" name="genres" id="genres-inp" value="<%=track.genres%>"> <br>
        <input type="checkbox" name="public_flag" id="public-flag-inp" checked=<%=track.public_flag%>> <br>
        <input type="file" name="image" id="image-inp"> <br>

        <button onclick="sendEdittedTrack()">Edit</button>
    </div>

    <script src="../public/scripts/track-func.js"></script>
    <script src="../public/scripts/script.js"></script>
</body>
</html>